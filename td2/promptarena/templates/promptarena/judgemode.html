{% extends "baseapp/base.html" %}
{% load static %}
{% block headtag %}
{% if form %}
    {{ form.media }}
{% endif %}
    {% endblock %}
{% block header %}Judgemode{% endblock header %}

{% block sidebar %}
    <h3 class="h4">Stories to judge</h2>

{% if crit_list %}

    {% regroup crit_list by entry.contest as crit_list_regrouped %}

    {% for contest in crit_list_regrouped %}
        <h4 class="h5">{{ contest.grouper }}</h3>
            <ul>
            {% for crit in contest.list %}
                {% if crit.content is not "" and crit.score is not '0' %}
                    <li><a href="{% url 'judgemode' crit.entry.id %}">{{ crit.entry.story.title }}</a></li>
                {% elif crit.final is not True %}
                    <li><a href="{% url 'judgemode' crit.entry.id crit.id %}">{{ crit.entry.story.title }}</a></li>
                {% else %}
                    Judged: {{ crit.entry.story.title }}
                {% endif %}
            {% endfor %}
            </ul>
    {% endfor %}

{% else %}
    You are not currently judging anything.
{% endif %}


{% endblock sidebar %}

{% block content %}
{% if form %}
    {% if form.non_field_errors %}
        <div class="alert alert-danger">
            <strong>There was a problem with your form - <a href="#form">See errors</a></strong>
        </div>
    {% else %}
        {% for field in form %}
            {% if field.errors %}
                <div class="alert alert-danger">
                    <strong>There was a problem with your form - <a href="#form">See errors</a></strong>
                </div>
            <!-- {% endif %}
        {% endfor %} <!-- -->
    {% endif %}

    <h2>{{ entry.story.title}}</h2>
    {{ entry.story.content | safe }}
    <img src="{% static 'baseapp/img/flourish.png' %}" alt="logo" class="rounded mx-auto d-block" />
    <form method = "post" id="form">
            {% csrf_token %}
            {% include 'baseapp/base-form.html' %}
        <input type="submit" value="Submit" class='btn btn-primary'>

    </form>
{% else %}
    <p>Judgemode show you the stories you currently have to critique in the contests you have entered.</p>
    <ol>
        <li>Choose a story from the list on the left</li>
        <li>Read it and think about it</li>
        <li>Provide a critique of at least 100 words. This isn't a hugfest - nobody will improve if you're not honest.
            If you can't be kind, at least be funny. If you can't be constructive, think about it some more and try again.</li>
        <li>Provide an overall ranking. For contestant judged contests, there will usually be three stories to judge.
            Score them relative to each other, and the world. If you think one is head and shoulders over the others,
            select 'High' for that story, then assign 'Low' and 'Low mid' to the others.</li>
        <li>Individual scores are private - all your authors will see is your comments.</li>
        <li>You can revisit your work at any point, until you check the 'Final' box and submit. then it will disappear
            from your judgemode list</li>
    </ol>
{% endif %}
{% endblock %}